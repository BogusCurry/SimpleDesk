<?xml version="1.0"?>
<!DOCTYPE modification SYSTEM "http://www.simplemachines.org/xml/modification">
<modification xmlns="http://www.simplemachines.org/xml/modification" xmlns:smf="http://www.simplemachines.org/">
	<id>SimpleDeskTeam:SimpleDesk</id>
	<version>2.0</version>

	<file name="$sourcedir/Packages.php"><!-- Sorts the SD plugin packages into the relevant container. -->
		<operation>
			<search position="before"><![CDATA[$context['modification_types'] = $installed ? array('modification') : array('modification', 'avatar', 'language']]></search>
			<add><![CDATA[, 'sdplugin']]></add>
		</operation>
		<operation>
			<search position="after"><![CDATA[	$context['available_languages'] = array();]]></search>
			<add><![CDATA[	$context['available_sdplugin'] = array();
]]></add>
		</operation>
		<operation>
			<search position="after"><![CDATA[				// Other stuff.
				else
				{
					$sort_id['unknown']++;]]></search>
			<add><![CDATA[				// SimpleDesk Plugins
				elseif ($packageInfo['type'] == 'sdplugin')
				{
					$sort_id['sdplugin']++;
					$packages['sdplugin'][strtolower($packageInfo[$sort])] = md5($package);
					$context['available_sdplugin'][md5($package)] = $packageInfo;
				}
]]></add>
		</operation>
	</file>

	<file name="$sourcedir/PackageGet.php"><!-- Make the install button available after an upload or a download. Code's the same, just gotta run twice. -->
		<operation>
			<search position="replace"><![CDATA[	if ($context['package']['type'] == 'modification')
		$context['package']['install']['link'] = '<a href="' . $scripturl . '?action=admin;area=packages;sa=install;package=' . $context['package']['filename'] . '">[ ' . $txt['install_mod'] . ' ]</a>';
	elseif ($context['package']['type'] == 'avatar')]]></search>
			<add><![CDATA[	if ($context['package']['type'] == 'modification')
		$context['package']['install']['link'] = '<a href="' . $scripturl . '?action=admin;area=packages;sa=install;package=' . $context['package']['filename'] . '">[ ' . $txt['install_mod'] . ' ]</a>';
	elseif ($context['package']['type'] == 'sdplugin')
		$context['package']['install']['link'] = '<a href="' . $scripturl . '?action=admin;area=packages;sa=install;package=' . $context['package']['filename'] . '">[ ' . $txt['shd_install_plugin'] . ' ]</a>';
	elseif ($context['package']['type'] == 'avatar')]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[	if ($context['package']['type'] == 'modification')
		$context['package']['install']['link'] = '<a href="' . $scripturl . '?action=admin;area=packages;sa=install;package=' . $context['package']['filename'] . '">[ ' . $txt['install_mod'] . ' ]</a>';
	elseif ($context['package']['type'] == 'avatar')]]></search>
			<add><![CDATA[	if ($context['package']['type'] == 'modification')
		$context['package']['install']['link'] = '<a href="' . $scripturl . '?action=admin;area=packages;sa=install;package=' . $context['package']['filename'] . '">[ ' . $txt['install_mod'] . ' ]</a>';
	elseif ($context['package']['type'] == 'sdplugin')
		$context['package']['install']['link'] = '<a href="' . $scripturl . '?action=admin;area=packages;sa=install;package=' . $context['package']['filename'] . '">[ ' . $txt['shd_install_plugin'] . ' ]</a>';
	elseif ($context['package']['type'] == 'avatar')]]></add>
		</operation>
	</file>
</modification>